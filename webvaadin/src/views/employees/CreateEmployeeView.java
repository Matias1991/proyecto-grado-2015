package views.employees;

import servicelayer.service.ServiceWebStub.VOEmployed;
import servicelayer.service.ServiceWebStub.VOSalarySummary;
import utils.PopupWindow;
import views.BaseView;

import com.example.webvaadin.WebvaadinUI;
import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.util.ObjectProperty;
import com.vaadin.ui.AbsoluteLayout;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.GridLayout;
import com.vaadin.ui.Label;
import com.vaadin.ui.OptionGroup;
import com.vaadin.ui.TabSheet;
import com.vaadin.ui.TextField;
import com.vaadin.ui.Button.ClickEvent;

import controllers.EmployeeController;

public class CreateEmployeeView extends BaseView {

	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

	@AutoGenerated
	private AbsoluteLayout mainLayout;
	@AutoGenerated
	private Button btnCancel;
	@AutoGenerated
	private Button btnCreate;
	@AutoGenerated
	private TabSheet tabTaxes;
	@AutoGenerated
	private OptionGroup optEmployeeType;
	@AutoGenerated
	private TextField txtCellPhone;
	@AutoGenerated
	private TextField txtEmail;
	@AutoGenerated
	private TextField txtAddress;
	@AutoGenerated
	private TextField txtSurname;
	@AutoGenerated
	private Label lblTitle;
	@AutoGenerated
	private TextField txtName;
	private TextField txtNominalSalary;
	private TextField txtTickets;
	private TextField txtPercentagePersonalFonasaContribution;
	private TextField txtRet;
	private TextField txtIrpf;
	private TextField txtBse;
	private TextField txtHours;
	private TextField txtCostSaleHour;
	private TextField txtPersonalRetirementContribution;
	private TextField txtEmployerRetirementContribution;
	private TextField txtPersonalFrlContribution;
	private TextField txtEmployerFrlContribution;
	private TextField txtPersonalFonasaContribution;
	private TextField txtEmployerFonasaContribution;
	private TextField txtTicketsEmployer;
	private TextField txtTotalDiscounts;
	private TextField txtTotalEmployersContribution;
	private TextField txtNominalWithoutContribution;
	private TextField txtDismisalPrevension;
	private TextField txtIncidenceSalary;
	private TextField txtSalaryToPay;
	private TextField txtCostMonth;
	private TextField txtCostRealHour;
	private Button btnEstimate;	
	
	

	/**
	 * The constructor should first build the main layout, set the
	 * composition root and then do any custom initialization.
	 *
	 * The constructor will not be automatically regenerated by the
	 * visual editor.
	 */
	public CreateEmployeeView() {
		buildMainLayout();
		setCompositionRoot(mainLayout);
		
		// TODO add user code here
		optEmployeeType.addItems("Empleado", "Socio");
		optEmployeeType.select("Empleado");
		
		// Sueldo Nominal
		txtNominalSalary = new TextField();
		txtNominalSalary.setCaption("Sueldo Nominal");
		txtNominalSalary.setImmediate(false);
		txtNominalSalary.setWidth("-1px");
		txtNominalSalary.setHeight("-1px");
		txtNominalSalary.setRequired(true);
		
				
		
		// Tickets
		txtTickets = new TextField();
		txtTickets.setCaption("Tickets");
		txtTickets.setImmediate(false);
		txtTickets.setWidth("-1px");
		txtTickets.setHeight("-1px");
		txtTickets.setRequired(true);
		
		// RET
		txtRet = new TextField();
		txtRet.setCaption("RET");
		txtRet.setImmediate(false);
		txtRet.setWidth("-1px");
		txtRet.setHeight("-1px");
		txtRet.setRequired(true);
		
		// IRPF
		txtIrpf = new TextField();
		txtIrpf.setCaption("IRPF");
		txtIrpf.setImmediate(false);
		txtIrpf.setWidth("-1px");
		txtIrpf.setHeight("-1px");
		txtIrpf.setRequired(true);
		
		// BSE
		txtBse = new TextField();
		txtBse.setCaption("BSE");
		txtBse.setImmediate(false);
		txtBse.setWidth("-1px");
		txtBse.setHeight("-1px");
		txtBse.setRequired(true);
		
		// Horas mensuales
		txtHours = new TextField();
		txtHours.setCaption("Cantidad Horas Mensual");
		txtHours.setImmediate(false);
		txtHours.setWidth("-1px");
		txtHours.setHeight("-1px");
		txtHours.setRequired(true);
		
		// Precio de venta por hora
		txtCostSaleHour = new TextField();
		txtCostSaleHour.setCaption("Hora Venta");
		txtCostSaleHour.setImmediate(false);
		txtCostSaleHour.setWidth("-1px");
		txtCostSaleHour.setHeight("-1px");
		txtCostSaleHour.setRequired(true);
		
		// Porcentaje aporte FONASA Personal
		txtPercentagePersonalFonasaContribution = new TextField();
		txtPercentagePersonalFonasaContribution.setCaption("% Aporte FONASA Personal");
		txtPercentagePersonalFonasaContribution.setImmediate(false);
		txtPercentagePersonalFonasaContribution.setWidth("-1px");
		txtPercentagePersonalFonasaContribution.setHeight("-1px");
		txtPercentagePersonalFonasaContribution.setRequired(true);
		
		// Aporte Jubilatorio Personal
		txtPersonalRetirementContribution = new TextField();
		txtPersonalRetirementContribution.setCaption("Aporte Jubilatorio Personal");
		txtPersonalRetirementContribution.setImmediate(false);
		txtPersonalRetirementContribution.setWidth("-1px");
		txtPersonalRetirementContribution.setHeight("-1px");
		txtPersonalRetirementContribution.setReadOnly(true);

		// Aporte Jubilatorio Patronal
		txtEmployerRetirementContribution = new TextField();
		txtEmployerRetirementContribution.setCaption("Aporte Jubilatorio Patronal");
		txtEmployerRetirementContribution.setImmediate(false);
		txtEmployerRetirementContribution.setWidth("-1px");
		txtEmployerRetirementContribution.setHeight("-1px");
		txtEmployerRetirementContribution.setReadOnly(true);

		// Aporte FRL Personal
		txtPersonalFrlContribution = new TextField();
		txtPersonalFrlContribution.setCaption("Aporte FRL Personal");
		txtPersonalFrlContribution.setImmediate(false);
		txtPersonalFrlContribution.setWidth("-1px");
		txtPersonalFrlContribution.setHeight("-1px");
		txtPersonalFrlContribution.setReadOnly(true);

		// Aporte FRL Patronal
		txtEmployerFrlContribution = new TextField();
		txtEmployerFrlContribution.setCaption("Aporte FRL Patronal");
		txtEmployerFrlContribution.setImmediate(false);
		txtEmployerFrlContribution.setWidth("-1px");
		txtEmployerFrlContribution.setHeight("-1px");
		txtEmployerFrlContribution.setReadOnly(true);

		// Aporte FONASA Personal
		txtPersonalFonasaContribution = new TextField();
		txtPersonalFonasaContribution.setCaption("Aporte FONASA Personal");
		txtPersonalFonasaContribution.setImmediate(false);
		txtPersonalFonasaContribution.setWidth("-1px");
		txtPersonalFonasaContribution.setHeight("-1px");
		txtPersonalFonasaContribution.setReadOnly(true);

		// Aporte FONASA Patronal
		txtEmployerFonasaContribution = new TextField();
		txtEmployerFonasaContribution.setCaption("Aporte FONASA Patronal");
		txtEmployerFonasaContribution.setImmediate(false);
		txtEmployerFonasaContribution.setWidth("-1px");
		txtEmployerFonasaContribution.setHeight("-1px");
		txtEmployerFonasaContribution.setReadOnly(true);

		// Tickets Patronal
		txtTicketsEmployer = new TextField();
		txtTicketsEmployer.setCaption("Tickets Patronal");
		txtTicketsEmployer.setImmediate(false);
		txtTicketsEmployer.setWidth("-1px");
		txtTicketsEmployer.setHeight("-1px");
		txtTicketsEmployer.setReadOnly(true);

		// Total Descuentos
		txtTotalDiscounts = new TextField();
		txtTotalDiscounts.setCaption("Total Descuentos");
		txtTotalDiscounts.setImmediate(false);
		txtTotalDiscounts.setWidth("-1px");
		txtTotalDiscounts.setHeight("-1px");
		txtTotalDiscounts.setReadOnly(true);

		// Total Aportes Patronales
		txtTotalEmployersContribution = new TextField();
		txtTotalEmployersContribution.setCaption("Total Aportes Patronales");
		txtTotalEmployersContribution.setImmediate(false);
		txtTotalEmployersContribution.setWidth("-1px");
		txtTotalEmployersContribution.setHeight("-1px");
		txtTotalEmployersContribution.setReadOnly(true);

		// Nominal Sin Aportes
		txtNominalWithoutContribution = new TextField();
		txtNominalWithoutContribution.setCaption("Nominal Sin Aportes");
		txtNominalWithoutContribution.setImmediate(false);
		txtNominalWithoutContribution.setWidth("-1px");
		txtNominalWithoutContribution.setHeight("-1px");
		txtNominalWithoutContribution.setReadOnly(true);

		// Prevision Despido
		txtDismisalPrevension = new TextField();
		txtDismisalPrevension.setCaption("Prevision Despido");
		txtDismisalPrevension.setImmediate(false);
		txtDismisalPrevension.setWidth("-1px");
		txtDismisalPrevension.setHeight("-1px");
		txtDismisalPrevension.setReadOnly(true);

		// Incidencia Sueldo
		txtIncidenceSalary = new TextField();
		txtIncidenceSalary.setCaption("Incidencia Sueldo");
		txtIncidenceSalary.setImmediate(false);
		txtIncidenceSalary.setWidth("-1px");
		txtIncidenceSalary.setHeight("-1px");
		txtIncidenceSalary.setReadOnly(true);

		// Sueldos a Pagar
		txtSalaryToPay = new TextField();
		txtSalaryToPay.setCaption("Sueldos A Pagar");
		txtSalaryToPay.setImmediate(false);
		txtSalaryToPay.setWidth("-1px");
		txtSalaryToPay.setHeight("-1px");
		txtSalaryToPay.setReadOnly(true);

		// Costo Mensual
		txtCostMonth = new TextField();
		txtCostMonth.setCaption("Costo Mensual");
		txtCostMonth.setImmediate(false);
		txtCostMonth.setWidth("-1px");
		txtCostMonth.setHeight("-1px");
		txtCostMonth.setReadOnly(true);

		// Costo Hora Meerkat
		txtCostRealHour = new TextField();
		txtCostRealHour.setCaption("Costo Hora Meerkat");
		txtCostRealHour.setImmediate(false);
		txtCostRealHour.setWidth("-1px");
		txtCostRealHour.setHeight("-1px");
		txtCostRealHour.setReadOnly(true);
		
		// Boton Estimar
		btnEstimate = new Button();
		btnEstimate.setCaption("Estimar");
		btnEstimate.setImmediate(false);
		btnEstimate.setWidth("-1px");
		btnEstimate.setHeight("-1px");
		
		//TAB 1
		GridLayout tab1 = new GridLayout(2, 5);
		tab1.setSpacing(true);		
		tab1.addComponent(txtNominalSalary, 0, 0);
		tab1.addComponent(txtTickets, 1, 0);		
		tab1.addComponent(txtPercentagePersonalFonasaContribution, 0,1);
		tab1.addComponent(txtRet,1,1);
		tab1.addComponent(txtIrpf,0,2);
		tab1.addComponent(txtBse,1,2);
		tab1.addComponent(txtHours,0,3);
		tab1.addComponent(txtCostSaleHour,1,3);
		tab1.addComponent(btnEstimate,0,4);
		tabTaxes.addTab(tab1, "Costos 1");
		
		//TAB 2
		GridLayout tab2 = new GridLayout(2,4);
		tab2.setSpacing(true);
		tab2.addComponent(txtPersonalRetirementContribution,0,0);
		tab2.addComponent(txtEmployerRetirementContribution,1,0);
		tab2.addComponent(txtPersonalFrlContribution,0,1);
		tab2.addComponent(txtEmployerFrlContribution,1,1);
		tab2.addComponent(txtPersonalFonasaContribution,0,2);
		tab2.addComponent(txtEmployerFonasaContribution,1,2);
		tab2.addComponent(txtTicketsEmployer,0,3);
		tab2.addComponent(txtTotalDiscounts,1,3);
		tabTaxes.addTab(tab2, "Costos 2");
		
		
		//TAB3
		GridLayout tab3 = new GridLayout(2,4);
		tab3.setSpacing(true);
		tab3.addComponent(txtTotalEmployersContribution,0,0);
		tab3.addComponent(txtNominalWithoutContribution,1,0);		
		tab3.addComponent(txtIncidenceSalary,0,1);
		tab3.addComponent(txtDismisalPrevension,1,1);		
		tab3.addComponent(txtCostMonth,0,2);
		tab3.addComponent(txtCostRealHour,1,2);
		tab3.addComponent(txtSalaryToPay,0,3);		
		tabTaxes.addTab(tab3, "Costos 3");
		
		
		btnEstimate.addClickListener(new Button.ClickListener() {
			
			@Override
			public void buttonClick(ClickEvent event) {
				// TODO Auto-generated method stub
				if (validateEstimateEmployee()){
					
					PopupWindow notification = new PopupWindow("AVISO", "FALTA CODIFICAR ESTA FUNCION");			
					
					
				}
				
			}
		});
		
		btnCreate.addClickListener(new Button.ClickListener() {
			
			@Override
			public void buttonClick(ClickEvent event) {
				// TODO Auto-generated method stub
				
				if(validateCreateEmployee()){
					VOEmployed newEmployee = new VOEmployed();
					newEmployee.setName(txtName.getValue());
					newEmployee.setLastName(txtSurname.getValue());
					newEmployee.setAddress(txtAddress.getValue());
					newEmployee.setEmail(txtEmail.getValue());
					newEmployee.setCellPhone(txtCellPhone.getValue());
					if(optEmployeeType.getValue().equals("Empleado")){
						newEmployee.setEmployedType(1);
					}else{
						newEmployee.setEmployedType(2);
					}
					
					VOSalarySummary newSalarySummary = new VOSalarySummary();
					newSalarySummary.setNominalSalary(Double.parseDouble(txtNominalSalary.getValue()));
					newSalarySummary.setTickets(Double.parseDouble(txtTickets.getValue()));
					newSalarySummary.setRET(Double.parseDouble(txtRet.getValue()));
					newSalarySummary.setIRPF(Double.parseDouble(txtIrpf.getValue()));
					newSalarySummary.setBSE(Double.parseDouble(txtBse.getValue()));
					newSalarySummary.setHours(Integer.parseInt(txtHours.getValue()));
					newSalarySummary.setCostSaleHour(Double.parseDouble(txtCostSaleHour.getValue()));
					newSalarySummary.setPercentageTypeFONASA(Double.parseDouble(txtPercentagePersonalFonasaContribution.getValue()));
					
					newEmployee.setVOSalarySummary(newSalarySummary);
				
				
					if(EmployeeController.createEmployee(newEmployee)){
						PopupWindow popup = new PopupWindow("AVISO", "Empleado creado correctamente");
						cleanInputs();
					}
				}				
			}
		});
		
		btnCancel.addClickListener(new Button.ClickListener() {
			
			@Override
			public void buttonClick(ClickEvent event) {
				// TODO Auto-generated method stub
				getUI().getNavigator().navigateTo(WebvaadinUI.MAINMENU);
			}
		});
		
		
		
	}
	
	public boolean validateEstimateEmployee(){
		boolean validate = true;
		String errors = "";
		
		if(txtNominalSalary.getValue().isEmpty()){
			errors += "Salario nominal es requerido\n";
		}
		
		if(txtTickets.getValue().isEmpty()){
			errors += "Tickets es requerido\n";
		}
		
		if(txtRet.getValue().isEmpty()){
			errors += "RET es requerido\n";
		}
		
		if(txtIrpf.getValue().isEmpty()){
			errors += "IRPF es requerido\n";
		}
		
		if(txtBse.getValue().isEmpty()){
			errors += "BSE es requerido\n";
		}
		
		if(txtHours.getValue().isEmpty()){
			errors += "Canidad Horas Mensual es requerido\n";
		}
		
		if(txtCostSaleHour.getValue().isEmpty()){
			errors += "Costo Venta Meerkat es requerido\n";
		}
		
		if(txtPercentagePersonalFonasaContribution.getValue().isEmpty()){
			errors += "% Aporte FONASA Personal es requerido\n";
		}
		
		if(errors != ""){
			validate = false;
			PopupWindow popup = new PopupWindow("ERROR", errors);
		}
		return validate;
		
	}
	
	public boolean validateCreateEmployee(){
		boolean validate = true;
		String errors = "";
		
		if(txtNominalSalary.getValue().isEmpty()){
			errors += "Salario nominal es requerido\n";
		}
		
		if(txtTickets.getValue().isEmpty()){
			errors += "Tickets es requerido\n";
		}
		
		if(txtRet.getValue().isEmpty()){
			errors += "RET es requerido\n";
		}
		
		if(txtIrpf.getValue().isEmpty()){
			errors += "IRPF es requerido\n";
		}
		
		if(txtBse.getValue().isEmpty()){
			errors += "BSE es requerido\n";
		}
		
		if(txtHours.getValue().isEmpty()){
			errors += "Canidad Horas Mensual es requerido\n";
		}
		
		if(txtCostSaleHour.getValue().isEmpty()){
			errors += "Costo Venta Meerkat es requerido\n";
		}
		
		if(txtPercentagePersonalFonasaContribution.getValue().isEmpty()){
			errors += "% Aporte FONASA Personal es requerido\n";
		}		
		
		if(txtName.getValue().isEmpty()){
			errors += "Nombre es requerido\n";
		}
		
		if(txtSurname.getValue().isEmpty()){
			errors += "Apellido es requerido\n";
		}
		
		
		if(errors != ""){
			validate = false;
			PopupWindow popup = new PopupWindow("ERROR", errors);
		}
		
		return validate;		
	}
	
	public void cleanInputs(){
		optEmployeeType.select("Empleado");
		txtCellPhone.clear();
		txtEmail.clear();
		txtAddress.clear();
		txtSurname.clear();
		txtName.clear();
		txtNominalSalary.clear();
		txtTickets.clear();
		txtPercentagePersonalFonasaContribution.clear();
		txtRet.clear();
		txtIrpf.clear();
		txtBse.clear();
		txtHours.clear();
		txtCostSaleHour.clear();
		txtPersonalRetirementContribution.clear();
		txtEmployerRetirementContribution.clear();
		txtPersonalFrlContribution.clear();
		txtEmployerFrlContribution.clear();
		txtPersonalFonasaContribution.clear();
		txtEmployerFonasaContribution.clear();
		txtTicketsEmployer.clear();
		txtTotalDiscounts.clear();
		txtTotalEmployersContribution.clear();
		txtNominalWithoutContribution.clear();
		txtDismisalPrevension.clear();
		txtIncidenceSalary.clear();
		txtSalaryToPay.clear();
		txtCostMonth.clear();
		txtCostRealHour.clear();
	}

	@AutoGenerated
	private AbsoluteLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new AbsoluteLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("1083px");
		mainLayout.setHeight("500px");
		
		// top-level component properties
		setWidth("1083px");
		setHeight("500px");
		
		// txtName
		txtName = new TextField();
		txtName.setCaption("Nombre");
		txtName.setImmediate(false);
		txtName.setWidth("390px");
		txtName.setHeight("-1px");
		txtName.setRequired(true);
		mainLayout.addComponent(txtName, "top:76.0px;left:0.0px;");
		
		// lblTitle
		lblTitle = new Label();
		lblTitle.setImmediate(false);
		lblTitle.setWidth("-1px");
		lblTitle.setHeight("-1px");
		lblTitle.setValue("Crear empleado");
		mainLayout.addComponent(lblTitle, "top:20.0px;left:0.0px;");
		
		// txtSurname
		txtSurname = new TextField();
		txtSurname.setCaption("Apellido");
		txtSurname.setImmediate(false);
		txtSurname.setWidth("390px");
		txtSurname.setHeight("-1px");
		txtSurname.setRequired(true);
		mainLayout.addComponent(txtSurname, "top:136.0px;left:0.0px;");
		
		// txtAddress
		txtAddress = new TextField();
		txtAddress.setCaption("Domicilio");
		txtAddress.setImmediate(false);
		txtAddress.setWidth("390px");
		txtAddress.setHeight("-1px");
		mainLayout.addComponent(txtAddress, "top:196.0px;left:0.0px;");
		
		// txtEmail
		txtEmail = new TextField();
		txtEmail.setCaption("Correo");
		txtEmail.setImmediate(false);
		txtEmail.setWidth("390px");
		txtEmail.setHeight("-1px");
		mainLayout.addComponent(txtEmail, "top:256.0px;left:0.0px;");
		
		// txtCellPhone
		txtCellPhone = new TextField();
		txtCellPhone.setCaption("Celular");
		txtCellPhone.setImmediate(false);
		txtCellPhone.setWidth("-1px");
		txtCellPhone.setHeight("-1px");
		mainLayout.addComponent(txtCellPhone, "top:317.0px;left:0.0px;");
		
		// optEmployeeType
		optEmployeeType = new OptionGroup();
		optEmployeeType.setCaption("Tipo");
		optEmployeeType.setImmediate(false);
		optEmployeeType.setWidth("-1px");
		optEmployeeType.setHeight("-1px");
		optEmployeeType.setRequired(true);
		mainLayout.addComponent(optEmployeeType, "top:317.0px;left:204.0px;");
		
		// tabTaxes
		tabTaxes = new TabSheet();
		tabTaxes.setCaption("Costos Empleado");
		tabTaxes.setImmediate(false);
		tabTaxes.setWidth("-1px");
		tabTaxes.setHeight("-1px");
		mainLayout.addComponent(tabTaxes, "top:76.0px;left:400.0px;");
		
		// btnCreate
		btnCreate = new Button();
		btnCreate.setCaption("Agregar");
		btnCreate.setImmediate(true);
		btnCreate.setWidth("-1px");
		btnCreate.setHeight("-1px");
		mainLayout.addComponent(btnCreate, "top:414.0px;left:0.0px;");
		
		// btnCancel
		btnCancel = new Button();
		btnCancel.setCaption("Cancelar");
		btnCancel.setImmediate(true);
		btnCancel.setWidth("-1px");
		btnCancel.setHeight("-1px");
		mainLayout.addComponent(btnCancel, "top:414.0px;left:120.0px;");
		
		
		return mainLayout;
	}

}
